<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Тестовое задание</title>
    </head>
    <body>
        <h1>Сравнение открытых OLAP-систем <br/>
            Big Data: ClickHouse, Druid и Pinot
        </h1> 
        <p>
            Оригинал - <a href="https://medium.com/@leventov/comparison-of-the-open-source-olap-systems
            -for-big-data-clickhouse-druid-and-pinot-8e042a5ed1c7">https://medium.com/@leventov/comparison-of-the-open-source-olap-systems <br/>
            -for-big-data-clickhouse-druid-and-pinot-8e042a5ed1c7</a>
        </p>
        <p> 
            <a href="https://clickhouse.com/">ClickHouse</a>, <a href="https://druid.apache.org/">Druid</a> и <a href="https://github.com/apache/pinot">Pilot</a> – три открытых хранилища данных, которые позволяют <br/>
            выполнять аналитические запросы на больших объемах данных с интерактивными <br/>
            задержками. Эта статья - перевод <a href="https://leventov.medium.com/comparison-of-the-open-source-olap-systems-for-big-data-clickhouse-druid-and-pinot-8e042a5ed1c7">подробного сравнения</a>, выполненного Романом <br/>
            Левентовым. 
        </p>
        <h3>Источники информации</h3>
        <p>
            Подробности реализации <b>ClickHouse</b> стали мне известны от <a href="https://github.com/ztlpn">Алексея Зателепина</a> <br/>
            одного из <b>ключевых разработчиков проекта</b>. Доступная на английском <br/>
            документация достаточно скудна – наилучшим источником информации служат <br/>
            последние четыре секции <a href = "#">данной страницы документации</a>.
        </p>
        <p id="1">
            <b>Я сам участвую в развитии Druid</b>, но у меня нет личной заинтересованности в <br/>
            этой системе - по правде говоря, скорее всего в ближайшее время я перестану <br/>
            заниматься её разработкой. Поэтому читатели могут рассчитывать на отсутствие <br/>
            какой-либо предвзятости. <br/>
        </p>
        <p>
            Всё, что я буду далее писать про <b>Pinot</b>, основывается на странице <a href="https://github.com/apache/pinot/wiki/">Архитектура в<br/>
            вики Pilot</a>, а также на других страницах вики в разделе “Проектная документация”. <br/>
            Последний раз они обновлялись в июне 2017 года - больше, чем полгода назад.
        </p>
        <p>
            Рецензентами оригинальной статьи стали Алексей Зателепин и <a href="https://github.com/ludv1x">Виталий Людвиченко</a> <br/>
            (разработчики ClickHouse), <a href="https://github.com/gianm">Жан Мерлино</a> (самый активный <br/>
            разработчик Druid), Кишор Гопалакришна (архитектор Pinot) и Жан-Француа Им <br/>
            (разработчик Pinot). Мы присоединяемся к благодарности автора и полагаем, что<br/>
            это многократно повышает авторитетность статьи.
        </p>
        <p>
            <b>Предупреждение:</b> статья достаточно большая, поэтому вполне возможно вы <br/>
            захотите ограничиться прочтением раздела “Заключение” в конце.
        </p>
        <br/>
        <h2>Сходство между системами</h2>
        <h3>Связанные данные и вычисления</h3>
        <p>
            <b>На фундаментальном уровне, ClickHouse, Druid и Pinot похожи</b>, поскольку они <br/>
            хранят данные и выполняют обработку запросов на одних и тех же узлах, уходя от <br/>
            “разъединенной” архитектуры BigQuery. Недавно я уже описывал несколько <br/>
            наследственных проблем со связанной архитектурой в случае Druid [<a href="#1">1</a>, <a href="#1">2</a>]. <br/>
            Открытого эквивалента для BigQuery на данный момент не существует (за <br/>
            исключением, разве что, <a href="https://drill.apache.org/">Drill</a>?)Возможным подходам к построению подобных <br/>
            открытых систем посвящена <a href="https://leventov.medium.com/design-of-a-cost-efficient-time-series-store-for-big-data-88c5dc41af8e"другая статье в моем блоге></a>.
        </p>
        <h3>Отличия от Big Data SQL-систем: индексы и статическое <br/>
            распределение данных</h3>
        <p>
            Рассматриваемые в этой статье системы <b>выполняют запросы быстрее</b>, чем <br/>
            системы Big Data из семейства класса SQL-on-Hadoop: Hive, Impala, Presto и Spark, <br/>
            даже когда последние получают доступ к данным, хранящимся в колоночном <br/>
            формате - к примеру, Parquet или Kudu. Это происходит потому, что в ClickHouse, <br/>
            Druid и Pinot:
            <ul>
                <li>
                    Имеется <b>свой собственный формат для хранения данных с <br/>
                    индексами</b>, и они тесно интегрированы с движками обработки запросов. <br/>
                    Системы класса SQL-on-Hadoop обычно можно назвать агностиками <br/>
                    относительно форматов данных и поэтому они менее “навязчивы” в <br/>
                    бэкендах Big Data.
                </li>
                <li>
                    <b>Данные распределены относительно “статично”</b> между узлами, и при <br/>
                    распределенном выполнении запроса это можно использовать. Обратная <br/>
                    сторона медали при этом в том, что ClickHouse, Druid и Pinot <b>не <br/>
                    поддерживают запросы, которые требуют перемещения большого <br/>
                    количества данных</b> между узлами - к примеру, join между двумя большими<br/>
                    таблицами.
                </li>
            </ul>
        </p>
        <h2>Отсутствие точечных обновлений и удалений</h2>
        <p>
            Находясь на другой стороне спектра баз данных, ClickHouse, Druid и Pinot <b>не <br/>
            поддерживают точечные обновления и удаления</b>, в противоположность <br/>
            колоночным системам вроде Kudu, InfluxDB и Vertica (?). Это даёт ClickHouse, Druid <br/>
            и Pinot возможность производить более эффективное колоночное сжатие и более <br/>
            агрессивные индексы, что означает <b>большую эффективность использования<br/>
            ресурсов</b> и быстрое выполнение запросов.
        </p>
        <p>
            Разработчики ClickHouse в Yandex планируют начать поддерживать обновления и <br/>
            удаления в будущем, но я не уверен, будут ли это “настоящие” точечные запросы <br/>
            или обновления/удаления диапазонов данных.
        </p>
        <h3>Поглощение в стиле Big Data</h3>
        <p>
            Все три системы поддерживают потоковое поглощение данных из Kafka. Druid и <br/>
            Pinot поддерживают потоковую передачу данных стриминг в <a href="https://en.wikipedia.org/wiki/Lambda_architecture">Лямбда-стиле</a> и <br/>
            пакетное поглощение одних и тех же данных. ClickHouse поддерживает пакетные <br/>
            вставки напрямую, поэтому ему не требуется отдельная система пакетного <br/>
            поглощения подобная той, что используется в Druid и Pinot. Если вас интересуют <br/>
            подробности, то их вы сможете найти далее.
        </p>
        <p>
            Все три системы проверены на работоспособность в крупных масштабах: в <br/>
            Yandex.Metrica работает кластер ClickHouse, состоящий из примерно десятка <br/>
            тысяч ядер CPU. В Metamarkets используется кластер Druid аналогичного размера. <br/>
            Один кластер Pinot в LinkedIn включает в себя “тысячи машин”.
        </p>
        <h3>Назрелость</h3>
        <p>
            Все рассматриваемые в статье системы являются <b>незрелыми по меркам <br/>
            открытых enterprise-систем Big Data</b>. Однако, скорее всего они незрелы не <br/>
            более, чем среднестатистическая открытая система Big Data - но это совсем <br/>
            другая история. В ClickHouse, Druid и Pinot недостает некоторых очевидных <br/>
            оптимизаций и функциональности, и они кишат багами (насчет ClickHouse и Pinot я <br/>
            не уверен на все 100%, но не вижу причин, по которым они в этом плане были бы <br/>
            лучше Druid).
            <br/>
            <br/>
            Это плавно подводит нас к следующему важному разделу.
        </p>
        <h2>Про сравнение производительности и выбор <br/>
        системы</h2>
        <p>
            Я регулярно вижу в сети, как некоторые проводят сравнения систем больших <br/>
            данных: они берут набор своих данных, каким-либо образом “скармливают” его <br/>
            оцениваемой системе, а затем немедленно пытаются измерить <br/>
            производительность - сколько памяти или дискового пространства было занято, и <br/>
            насколько быстро выполнялись запросы. Причем понимание того, как устроены <br/>
            изнутри испытываемые ими системы, у них отсутствует. Затем, используя лишь <br/>
            подобные специфичные данные о производительности - иногда вместе со <br/>
            списками функциональности, которая им нужна и которая есть в системе <em>на <br/>
            настоящий момент,</em> - они в итоге делают свой выбор или, что еще хуже, <br/>
            выбирают написать свою собственную, “лучшую” систему с нуля.
        </p>
        <p>
            Такой подход мне кажется неправильным, по крайней мере он неприменим в <br/>
            отношении открытых OLAP-систем для Big Data. Задача создания системы Bid <br/>
            Data OLAP, которая смогла бы работать эффективно в большинстве сценариев <br/>
            использования и содержала бы все необходимые функции настолько велика, что я <br/>
            оцениваю ее реализацию как минимум в <b>100 человеко-лет.</b>
        </p>
        <p>
            На сегодня, ClickHouse, Druid и Pinot оптимизированы <em>только</em> для конкретных <br/>
            сценариев использования, которые требуются их разработчиком - и содержат по <br/>
            большей части лишь те функции, в которых нуждаются сами разработчики. Я могу <br/>
            гарантировать, что ваш случай обязательно “упрется” в те узкие места, с которыми <br/>
            разработчики рассматриваемых OLAP-систем еще не сталкивались - или же в те <br/>
            места, что их не интересуют.
        </p>
        <p>
            Не говоря уже о том, что упомянутый выше подход “забросить данные в систему, о <br/>
            которой вы ничего не знаете, и затем измерить её эффективность” весьма <br/>
            вероятно даст искаженный результат из-за серьезных “узких” мест, которые на <br/>
            самом деле могли бы быть исправлены <b>простым изменением конфигурации</b>,<br/>
            схемы данных или другим построением запроса.
        </p>
        <h2>CloudFlare: ClickHouse против Druid</h2>
        <p>
            Одним таким примером, хорошо иллюстрирующим описанную выше проблему, <br/>
            является пост Марека Вавруша о выборе между ClickHouse и Druid в Cloudflare. Им <br/>
            потребовалось 4 сервера ClickHouse (которые со временем превратились в 9), и по <br/>
            их оценкам, для разворачивания аналогичной установки Druid им бы <br/>
            потребовались “сотни узлов”. Пусть Марек и признает, что <b>сравнение является <br/>
            нечестным</b>, поскольку Druid недостаёт “сортировки по первичному ключу”, он <br/>
            возможно даже не осознает, что достичь примерно того же самого эффекта в Druid <br/>
            возможно просто <a href="http://druid.io/docs/0.11.0/ingestion/index.html">установив правильный порядок измерений в <em>“ingestion spec”</em></a> и <br/>
            произведя простую подготовку данных: обрезать значение колонки <pre>__time</pre> в Druid <br/>
            до некоей грубой детализации (к примеру, один час) и опционально добавить <br/>
            другую “длинно-типовую” колонку “precise_time”, если для некоторых запросов <br/>
            требуются более точные временные рамки. Да, это хак, но, как мы только что <br/>
            выяснили, и в Druid можно сортировать данные по какому-либо измерению перед <br/>
            <pre>__time</pre>, и это достаточно просто реализовать.
        </p>
        <p>
            Впрочем, я не стану спорить с их итоговым решением выбрать ClickHouse, <br/>
            поскольку на масштабе примерно в 10 узлов и для их нужд ClickHouse мне тоже <br/>
            кажется лучшим выбором, чем Druid. Но сделанное ими заключение о том, что <br/>
            ClickHouse как минимум на порядок эффективнее (по меркам стоимости <br/>
            инфраструктуры), чем Druid - это серьезное заблуждение. На самом деле, из <br/>
            рассматриваемых нами сегодня систем, <b>Druid предлагает наилучшую <br/>
            возможность для реально дешевых установок</b> (смотрите раздел “Уровни узлов <br/>
            обработки запросов в Druid ” ниже).
        </p>
        <blockquote>
            Когда вы выбираете систему OLAP Big Data, не сравнивайте то, насколько <br/>
            они сейчас хорошо подходят для вашего случая. Сейчас они все <br/>
            субоптимальны. Вместо этого, сравните, насколько быстро ваша компания <br/>
            способна заставить двигаться эти системы в том направлении, которое <br/>
            нужно именно вам.
        </blockquote>
        <p>
            В силу своей фундаментальной архитектурной схожести, ClickHouse, Druid и Pinot <br/>
            имеют примерно один и тот же “предел” эффективности и оптимизации <br/>
            производительности. Здесь нет “волшебной таблетки”, которая позволила бы <br/>
            какой-либо из этих систем быть быстрее, чем остальные. Не позволяйте запутать <br/>
            себя тем фактом, что в своем <em>текущем состоянии</em> системы показывают себя <br/>
            очень по-разному в различных бенчмарках. 
        </p>
        <p>
            Допустим, Druid не поддерживает “сортировку по первичному ключу” настолько <br/>
            хорошо, насколько это умеет ClickHouse - а ClickHouse в свою очередь не <br/>
            поддерживает “инвертированные индексы” столь же хорошо, как Druid, что дает <br/>
            данным системам преимущества с той или иной нагрузкой. <b>Упущенные <br/>
            оптимизации могут быть реализованы в выбранной системе при помощи не <br/>
            таких уж и больших усилий,</b> если у вас есть намерение и возможность решиться <br/>
            на подобный шаг.
            <ul>
                <li>В вашей организации должны быть инженеры, способные прочитать, понять <br/>
                    и модифицировать исходный код выбранной системы, к тому же у них <br/>
                    должно быть на это время. Заметьте, что ClickHouse написан на C++, а <br/>
                    Druid и Pinot —  на Java.
                </li>
                <li>
                    Или же ваша организация должна подписать контракт с компанией, которая <br/>
                    оказывает поддержку выбранной системы. Это будут Altinity для ClickHouse, <br/>
                    Imply и Hortonworks для Druid. Для Pinot таких компаний в данный момент нет.

                </li>
            </ul>
        </p>
        <p>Другие сведения о разработке систем, которые вам стоит принять во внимание:</p>
        <ul>
            <li>Авторы ClickHouse, работающие в Yandex, утверждают, что они тратят 50% <br/>
                своего времени на создание функциональности, которая требуется им <br/>
                внутри компании, и другие 50% уходят на функции, который набирают <br/>
                большинство “голосов сообщества”. Однако, чтобы вы получили от этого <br/>
                факта преимущество, требуется, чтобы <b>функции, которые нужны вам, <br/>
                были и наиболее востребованы сообществом</b> ClickHouse.
            </li>
            <li>
                Разработчики Druid из Imply мотивированы работать над широко <br/>
                используемыми функциями, поскольку это позволит им максимально <br/>
                увеличить объем охвата своего бизнеса в будущем.
            </li>
            <li>
                Процесс разработки Druid сильно напоминает <a href="https://community.apache.org/apache-way/apache-project-maturity-model.html">модель Apache</a>, когда ПО <br/>
                несколько лет разрабатывается несколькими компаниями, у каждой из <br/>
                который достаточно своеобразные и различные приоритеты, и среди них <br/>
                нет ведущей компании. ClickHouse и Pinot пока еще далеки от подобного <br/>
                этапа, поскольку ими занимаются соответственно лишь Yandex и Linkedin. <br/>
                Сторонний вклад в развитие Druid имеет минимальный шанс быть <br/>
                отклоненным в силу того, что он расходится с видением основного <br/>
                разработчика - ведь <b>в Druid нет “основной” компании-разработчика.</b>
            </li>
            <li>
                Druid поддерживает “API разработчика”, который позволяет привносить <br/>
                собственные типы колонок, механизмы агрегации, возможные варианты для <br/>
                «глубокого хранения» и пр., причем все это вы можете держать в кодовой <br/>
                базе, отдельной от самого ядра Druid. Данное API документировано <br/>
                разработчиками Druid, и они следят за его совместимостью с предыдущими <br/>
                версиями. Однако, оно недостаточно “взрослое”, и ломается практически с <br/>
                каждым новым релизом Druid. Насколько мне известно, в ClickHouse и Pinot <br/>
                схожие API не поддерживаются.
            </li>
            <li>
                Согласно Github, <b>над Pinot работает наибольшее число людей</b> - по всей <br/>
                видимости, лишь за прошлый год в Pinot было вложено не менее 10 <br/>
                человеко-лет. Для ClickHouse эта цифра составляет примерно 6 человеко-<br/>
                лет, а для Druid - 7. В теории, это должно означать, что Pinot улучшается <br/>
                быстрее всех остальных систем, которые мы рассматриваем.
            </li>
        </ul>
        <p>
            Архитектуры Druid и Pinot почти что идентичны друг другу, в то время как <br/>
            ClickHouse стоит слегка в стороне. Поэтому сначала мы сравним ClickHouse c <br/>
            “обобщенной” архитектурой Druid/Pinot, а затем обсудим мелкие различия между <br/>
            Druid и Pinot.
        </p>
        <h2>Различия между ClickHouse и Druid/Pinot</h2>
        <h3>Управление данными: сравнение</h3>
        <p>
            Подход к управлению данными в ClickHouse проще, чем в Druid и Pinot: не <br/>
            требуется “глубокого хранилища”, всего один тип узлов, не требуется выделенного <br/>
            сервера для управления данными. Но подход ClickHouse приводит к некоторым <br/>
            трудностям, когда любая таблица данных вырастает настолько большой, что <br/>
            требуется ее разбиение между десятком или более узлов: коэффициент усиления <br/>
            запроса становится настолько же велик, насколько и фактор секционирования - <br/>
            даже для запросов, которые покрывают небольшой интервал данных:
        </p>
    </body>
</html>